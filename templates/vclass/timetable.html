{% extends 'vclass/base_vclass.html' %}
{% block title %}My Timetable{% endblock %}

{% block content %}
<div class="container mt-4">
  <h4 class="mb-4">üóìÔ∏è My Timetable ‚Äî {{ student_class }}</h4>

  {% if timetable_entries %}
    {% set days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'] %}
    {% set slots = timetable_entries | sort(attribute='start_time') | map(attribute='start_time') | unique | list %}

    <div class="table-responsive shadow rounded">
      <table class="table table-hover table-bordered text-center align-middle">
        <thead class="table-primary sticky-top">
          <tr>
            <th class="bg-primary text-white">Day / Time</th>
            {% for time in slots %}
              {% set slot_entry = timetable_entries | selectattr("start_time", "equalto", time) | list | first %}
              <th>
                {% if slot_entry %}
                  {{ slot_entry.start_time.strftime('%I:%M %p') }} - {{ slot_entry.end_time.strftime('%I:%M %p') }}
                {% else %}
                  Unknown
                {% endif %}
              </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for day in days %}
            <tr>
              <td><strong>{{ day }}</strong></td>
              {% for time in slots %}
                {% set match = timetable_entries
                  | selectattr("day_of_week", "equalto", day)
                  | selectattr("start_time", "equalto", time)
                  | list
                %}
                {% if match %}
                  <td class="bg-light">
                    <strong>{{ match[0].course.name }}</strong><br>
                    <small>{{ match[0].location or '' }}</small>
                  </td>
                {% else %}
                  <td>‚Äî</td>
                {% endif %}
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
      <i class="bi bi-info-circle me-2"></i> No timetable is available for your class at the moment.
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endif %}
  <div class="d-flex justify-content-end mb-3">
  <a href="{{ url_for('student.download_timetable', t=download_ts) }}" class="btn btn-success">
  <i class="bi bi-download me-1"></i> Download Timetable
</a>

</div>

</div>
{% endblock %}
