<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Teacher Panel{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrf_token() }}">

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      background: #ffffff; /* pure white background */
      font-family: "Poppins", sans-serif;
      transition: background-color 0.4s ease, color 0.4s ease;
    }

    /* Navbar */
    .navbar {
      background: linear-gradient(90deg, #5b21b6, #0ea5e9);
      padding: 0.9rem 1.2rem;
      backdrop-filter: blur(10px);
      border-bottom: 2px solid rgba(255,255,255,0.15);
    }
    .navbar-brand {
      font-family: "Orbitron", sans-serif;
      letter-spacing: 1px;
      font-size: 1.2rem;
    }

    /* Sidebar */
    .sidebar {
      background: linear-gradient(180deg, #1e1f2a, #101322);
      min-height: 100vh;
      padding-top: 70px;
      position: fixed;
      top: 0;
      left: 0;
      width: 240px;
      transition: width 0.3s ease, background 0.5s ease;
      overflow-x: hidden;
      white-space: nowrap;
      box-shadow: 4px 0 18px rgba(0,0,0,0.3);
    }
    .sidebar a {
      color: #cfd2dc;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }
    .sidebar a:hover {
      background: rgba(255,255,255,0.08);
      color: #fff;
      border-left: 4px solid #0ea5e9;
      box-shadow: inset 0 0 12px rgba(14,165,233,0.3);
    }
    .sidebar .active {
      background: linear-gradient(90deg, rgba(14,165,233,0.25), rgba(91,33,182,0.25));
      color: #fff;
      border-left: 4px solid #06b6d4;
      box-shadow: inset 0 0 15px rgba(14,165,233,0.4);
    }

    /* Collapsed sidebar */
    .sidebar.collapsed {
      width: 72px;
    }
    .sidebar.collapsed a span {
      display: none;
    }
    .sidebar.collapsed a {
      justify-content: center;
    }

    /* Animated Gradient Borders for Cards */
.card {
  position: relative;
  border: none;
  border-radius: 1rem;
  background: #fff;
  padding: 1rem;
  overflow: hidden;
  z-index: 1;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card::before {
  content: "";
  position: absolute;
  top: -2px; left: -2px; right: -2px; bottom: -2px;
  background: linear-gradient(270deg, #0ea5e9, #5b21b6, #06b6d4, #9333ea, #0ea5e9);
  background-size: 600% 600%;
  border-radius: 1.1rem;
  z-index: -1;
  animation: animatedBorder 8s linear infinite;
}
@keyframes animatedBorder {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Hover Glow (outer + inner shadow) */
.card:hover {
  transform: translateY(-6px);
  box-shadow: 
    0 12px 30px rgba(0,0,0,0.2),        /* normal shadow */
    0 0 25px rgba(14,165,233,0.6),      /* neon glow */
    inset 0 0 20px rgba(59,130,246,0.4); /* inner glow */
}

/* Dark Mode Card Enhancement */
.card.dark-mode {
  background: rgba(17,24,39,0.9);
  color: #f1f5f9;
}
.card.dark-mode::before {
  background: linear-gradient(270deg, #06b6d4, #3b82f6, #9333ea, #0ea5e9, #06b6d4);
}
.card.dark-mode:hover {
  box-shadow: 
    0 12px 30px rgba(0,0,0,0.6),
    0 0 25px rgba(147,51,234,0.7),
    inset 0 0 20px rgba(14,165,233,0.4);
}

    /* Main content */
.main-content {
  margin-left: 240px;
  padding: 25px;
  padding-top: 80px;
  transition: margin-left 0.3s ease;
  background: #ffffff;       /* â¬… solid white background */
  min-height: 100vh;         /* ensures full height white area */
  border-radius: 0.5rem;     /* optional: subtle rounding */
  box-shadow: 0 0 8px rgba(0,0,0,0.05); /* optional soft shadow */
}
.main-content.collapsed {
  margin-left: 72px;
}

    /* Alerts */
    .alert {
      position: fixed;
      top: 70px;
      left: 250px;
      right: 20px;
      z-index: 1050;
      max-width: calc(100% - 270px);
      border-radius: 0.75rem;
      box-shadow: 0 4px 18px rgba(0,0,0,0.15);
      animation: slideIn 0.5s ease;
    }
    .alert.collapsed {
      left: 90px;
      max-width: calc(100% - 110px);
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Dark Mode Neon */
    body.dark-mode { background: linear-gradient(135deg, #0f172a, #1e293b); color: #e0e0e0; }
    .navbar.dark-mode { background: linear-gradient(90deg, #312e81, #0369a1); }
    .sidebar.dark-mode { background: linear-gradient(180deg, #0f172a, #1e1e2f); }
    .sidebar.dark-mode a { color: #aaa; }
    .sidebar.dark-mode a:hover,
    .sidebar.dark-mode .active { background: rgba(14,165,233,0.12); color: #fff; border-left-color: #0ea5e9; box-shadow: inset 0 0 12px rgba(14,165,233,0.5); }
    .main-content.dark-mode { background: rgba(30,41,59,0.5); }
    .card.dark-mode { background: rgba(17,24,39,0.8); color: #e0e0e0; border: 1px solid rgba(255,255,255,0.1); }
    .alert.dark-mode { background: rgba(14,165,233,0.15); color: #f1f1f1; border: 1px solid rgba(14,165,233,0.3); }
  </style>
</head>
<body>

  <!-- Top Navbar -->
  <nav class="navbar navbar-expand-lg fixed-top shadow">
  <div class="container-fluid">
    <button class="btn btn-sm btn-outline-light me-3" id="toggleSidebar"><i class="fas fa-bars"></i></button>
    <a class="navbar-brand d-flex align-items-center text-white fw-bold" href="{{ url_for('teacher.dashboard') }}">
      <i class="fas fa-chalkboard-teacher me-2"></i> Teacher Panel
    </a>

    <ul class="navbar-nav ms-auto align-items-center">
      <li class="nav-item me-2">
        <button class="btn btn-sm btn-outline-light" id="toggleDarkMode"><i class="fas fa-moon"></i></button>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle text-white fw-semibold" href="#" role="button" data-bs-toggle="dropdown">
          <img src="{{ url_for('static', filename='uploads/profile_pictures/' ~ (current_user.profile_picture or 'default.png')) }}"
               alt="Profile" class="rounded-circle" width="28" height="28">
          &nbsp; {{ current_user.first_name }}
        </a>
        <ul class="dropdown-menu dropdown-menu-end shadow">
          <li><a class="dropdown-item" href="{{ url_for('teacher.profile') }}"><i class="fas fa-user"></i> My Profile</a></li>
          <li><a class="dropdown-item" href="{{ url_for('teacher.change_password') }}"><i class="fas fa-lock"></i> Change Password</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
      </li>
    </ul>
  </div>
</nav>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <a href="{{ url_for('teacher.dashboard') }}" class="active"><i class="fas fa-home"></i> <span>Dashboard</span></a>
    <a href="{{ url_for('teacher.classes') }}"><i class="fas fa-users"></i> <span>Classes</span></a>
    <a href="{{ url_for('teacher.manage_assignments') }}"><i class="fas fa-tasks"></i> <span>Assignments</span></a>

    <!-- New Submissions index (lists assignments grouped by course) -->
    <a href="{{ url_for('teacher.submissions_index') }}"><i class="fas fa-file-alt"></i> <span>Submissions</span></a>

    <a href="{{ url_for('teacher.attendance') }}"><i class="fas fa-check-square"></i> <span>Attendance</span></a>
    <a href="{{ url_for('teacher.calendar') }}"><i class="fas fa-calendar-check"></i> <span>Academic Calendar</span></a>
    <a href="{{ url_for('teacher.manage_slots') }}"><i class="fas fa-calendar-plus"></i> <span>Appointments</span></a>

    <a href="https://meet.google.com" target="_blank"><i class="fas fa-video"></i> <span>Google Meet</span></a>
    <a href="#"><i class="fas fa-bell"></i> <span>Notifications</span></a>
    <a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show shadow-sm" role="alert" id="alertBox">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </div>

  <!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const toggleSidebar = document.getElementById('toggleSidebar');
  const sidebar = document.getElementById('sidebar');
  const mainContent = document.getElementById('mainContent');

  // helper: safely update FullCalendar if present
  function safeUpdateCalendar(delay = 120) {
    // small delay so CSS transition/layout settles
    setTimeout(() => {
      try {
        if (window._fcCalendar && typeof window._fcCalendar.updateSize === 'function') {
          window._fcCalendar.updateSize();
        }
      } catch (e) {
        // ignore if calendar not ready or destroyed
        console.debug('safeUpdateCalendar failed', e);
      }
    }, delay);
  }

  toggleSidebar.addEventListener('click', () => {
    sidebar.classList.toggle('collapsed');
    mainContent.classList.toggle('collapsed');
    document.querySelectorAll('.alert').forEach(el => el.classList.toggle('collapsed'));
    localStorage.setItem('sidebar', sidebar.classList.contains('collapsed') ? 'collapsed' : 'expanded');

    // call update on the calendar after toggle (wait a little for transition)
    safeUpdateCalendar(160);
  });

  // If page loads with a collapsed sidebar saved, apply and then update calendar
  if (localStorage.getItem('sidebar') === 'collapsed') {
    sidebar.classList.add('collapsed');
    mainContent.classList.add('collapsed');
    // ensure alerts adjust too
    document.querySelectorAll('.alert').forEach(el => el.classList.add('collapsed'));
    // Give the browser a tick to apply styles then resize calendar
    safeUpdateCalendar(60);
  }

  // Also listen for the sidebar's CSS transition end (robust when transition duration varies)
  // This ensures calendar always recalculates when the sidebar finishes animating.
  sidebar.addEventListener('transitionend', (ev) => {
    // only care when width changed
    if (ev.propertyName === 'width' || ev.propertyName === 'transform' || ev.propertyName === 'left') {
      safeUpdateCalendar(20);
    }
  });

  // Dark mode toggles (unchanged)
  const toggleDarkMode = document.getElementById('toggleDarkMode');
  const body = document.body, navbar = document.querySelector('.navbar');
  const enableDarkMode = () => {
    body.classList.add('dark-mode'); navbar.classList.add('dark-mode');
    sidebar.classList.add('dark-mode'); mainContent.classList.add('dark-mode');
    document.querySelectorAll('.card,.alert,.dropdown-menu').forEach(el => el.classList.add('dark-mode'));
    localStorage.setItem('darkMode','enabled');
    // if calendar present, refresh colors / layout
    safeUpdateCalendar(40);
  };
  const disableDarkMode = () => {
    body.classList.remove('dark-mode'); navbar.classList.remove('dark-mode');
    sidebar.classList.remove('dark-mode'); mainContent.classList.remove('dark-mode');
    document.querySelectorAll('.card,.alert,.dropdown-menu').forEach(el => el.classList.remove('dark-mode'));
    localStorage.setItem('darkMode','disabled');
    safeUpdateCalendar(40);
  };
  if (localStorage.getItem('darkMode')==='enabled') enableDarkMode();
  toggleDarkMode.addEventListener('click', () => body.classList.contains('dark-mode') ? disableDarkMode() : enableDarkMode());
</script>

</body>
</html>
